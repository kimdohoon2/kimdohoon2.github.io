---
layout: single
title: "CORS란? 해결방법"
categories: 기술면접
tag: [CORS]
toc: true
author_profile: false
# sidebar:
#     nav: "counts"
# search: true
---

## CORS란?

CORS (Cross-Origin Resource Sharing) 에러는 브라우저에서 서로 다른 도메인 간에 리소스를 요청할 때 발생하는 보안 제한입니다. 브라우저는 기본적으로 다른 도메인에서 제공하는 리소스를 요청하는 것을 제한하여, 악의적인 웹사이트가 다른 도메인에서 데이터를 훔쳐가는 것을 방지합니다. 이 때 발생하는 에러가 CORS 에러입니다.

예를 들어, https://example.com에서 https://api.example.com으로 API 요청을 보냈을 때, 브라우저는 두 도메인이 다르므로 기본적으로 요청을 차단합니다.

## 해결방법

### CORS 설정에 대한 요구 (프론트엔드 개발자가 할 수 있음)

CORS 에러는 주로 서버에서의 설정 부족으로 발생하기 때문에, 프론트엔드 개발자는 백엔드 팀에 요청하여 CORS 정책을 수정할 수 있습니다.
예를 들어, 서버에서 Access-Control-Allow-Origin 헤더를 설정하여, 프론트엔드에서 API 요청이 허용되도록 해야 합니다.

서버에 요청: 서버가 CORS를 허용하도록 설정해달라고 백엔드 개발자에게 요청할 수 있습니다. 예를 들어, 서버에서 Express를 사용하는 경우:

```js
const cors = require("cors");
app.use(cors({ origin: "https://your-frontend-domain.com" }));
```

만약 모든 도메인에서 접근을 허용하고 싶다면, '\*'을 사용할 수 있습니다.

```js
app.use(cors({ origin: "*" }));
```

### 프록시 서버 사용 (프론트엔드 개발자가 할 수 있음)

프론트엔드 개발자는 프록시 서버를 설정하여 CORS 에러를 우회할 수 있습니다. 주로 개발 환경에서 사용할 수 있는 방법으로, 클라이언트 요청을 서버로 우회시켜 서버가 CORS 관련 처리를 하지 않도록 하는 방법입니다.
create-react-app에서 프록시 설정

```json
"proxy": "http://localhost:5173"
```

package.json에 프록시 URL을 추가하면, React 개발 서버에서 API 요청이 프록시 서버를 통해 전달됩니다. 이 방법은 개발 환경에서만 유효하며, 실제 배포 환경에서는 서버 측에서 CORS 헤더를 설정해야 합니다.

프록시 서버 직접 설정: 프론트엔드 애플리케이션이 개발 중이라면, Node.js나 Express와 같은 간단한 프록시 서버를 설정하여 클라이언트 요청을 중계할 수 있습니다. 예를 들어

```js
const express = require("express");
const app = express();
const cors = require("cors");
app.use(cors());

app.use("/api", (req, res) => {
  // 요청을 실제 API 서버로 전달
});

app.listen(3000, () => {
  console.log("Proxy server running on http://localhost:3000");
});
```

### Preflight 요청 처리 (서버 측 해결)

CORS 요청 중 Preflight 요청이 발생하는 경우, 서버에서 OPTIONS 메서드에 대한 응답을 처리해야 합니다. 이는 주로 서버 측의 설정으로, 프론트엔드 개발자가 직접 해결할 수 없습니다. 그러나 프론트엔드 개발자는 Preflight 요청이 발생하는지 확인하고, 서버 측에서 이를 적절히 처리하도록 백엔드 팀에 전달할 수 있습니다.

Preflight 요청이란? CORS 요청이 특정 조건을 만족할 때 브라우저는 먼저 OPTIONS 메서드를 사용해 서버에 CORS 설정을 확인합니다. 이때 서버가 OPTIONS 메서드에 대한 응답을 제대로 보내지 않으면, 브라우저는 본 요청을 차단합니다. 이 문제는 서버 측에서 해결해야 하므로, 프론트엔드 개발자는 서버에서 OPTIONS에 대한 적절한 응답을 설정하도록 요청할 수 있습니다.

### CORS 우회 서비스 사용 (프론트엔드 개발자가 할 수 있음)

프론트엔드 개발자가 CORS 우회 서비스를 사용하여 문제를 해결할 수 있습니다. 이 방법은 주로 개발 및 테스트 환경에서 사용됩니다.

CORS Anywhere와 같은 서비스를 사용하여 CORS 우회를 할 수 있습니다. 예를 들어, 요청 URL을 https://cors-anywhere.herokuapp.com/와 같은 프록시 서버를 통해 우회시킬 수 있습니다.

```js
const url = "https://cors-anywhere.herokuapp.com/https://api.example.com/data";
fetch(url)
  .then((response) => response.json())
  .then((data) => console.log(data));
```

하지만 이 방법은 보안상 안전하지 않고, 서비스가 제한될 수 있기 때문에 실제 배포 환경에서는 사용하지 않아야 합니다.

### 결론

프론트엔드 개발자가 할 수 있는 CORS 문제 해결 방법은 다음과 같습니다

- 프록시 서버 설정: 개발 환경에서 프록시를 설정하여 CORS 문제를 우회합니다.
- 서버 측 CORS 설정 요청: 백엔드 팀에게 CORS 설정을 요청하여 서버에서 적절히 CORS 정책을 설정하도록 합니다.
- CORS 우회 서비스 사용: 개발 및 테스트 환경에서 CORS 우회 서비스를 사용할 수 있습니다.
  그러나 Preflight 요청 처리와 같은 문제는 서버 측에서 해결해야 하므로, 프론트엔드 개발자는 주로 서버 측에 요청을 전달하는 방식으로 해결할 수 있습니다.

### 악영향

실제로 CORS 설정 문제로 인한 악영향이 발생한 사례들이 있습니다. 몇 가지 주요 사례를 소개드리겠습니다:

1. GitHub의 CORS 설정 문제
   사례: GitHub은 초기에 API를 호출하는 데 CORS 설정이 잘못되어 있었고, 이로 인해 일부 외부 서비스가 GitHub API를 호출할 때 에러가 발생했습니다. 특히 GitHub Gist API를 사용할 때 CORS 에러가 발생하여, 외부 도메인에서 데이터를 가져오는 데 어려움이 있었습니다.

   악영향: 외부 애플리케이션에서 GitHub Gist 데이터를 자동으로 가져오는 기능이 정상 작동하지 않아, 사용자들이 기능을 사용할 수 없었으며 서비스 신뢰도가 저하되었습니다.

   해결: GitHub은 이후 CORS 설정을 수정하여 API 호출을 허용하는 도메인을 명확하게 설정했습니다.

2. Uber의 CORS 설정 문제
   사례: Uber의 개발팀은 CORS 설정을 제대로 관리하지 못했을 때, 외부 서비스에서 Uber API를 호출할 수 없는 문제가 발생했습니다. 특히 사용자 위치 정보를 처리하는 API 호출에서 CORS 오류가 발생했으며, 모바일 애플리케이션과 웹 애플리케이션 간의 데이터 통신에 문제가 있었습니다.

   악영향: Uber는 개발자들과 협력하여 API 호출을 해야 하는 외부 서비스가 데이터에 접근하지 못하게 되면서 사용자 경험에 큰 영향을 주었습니다. 또한, 이로 인해 배달과 같은 실시간 서비스에 지연이 발생했습니다.

   해결: Uber는 API 서버에 대한 CORS 정책을 수정하고, 보안적인 문제를 고려하여 도메인 기반으로 허용을 세밀하게 설정했습니다.

3. Trello와 외부 플러그인 CORS 문제
   사례: Trello는 외부에서 플러그인을 사용하여 데이터를 가져오는 기능이 있었으나, 외부 플러그인에서 CORS 오류가 발생하는 일이 많았습니다. 특히 플러그인 내에서 Trello API를 호출할 때 CORS 정책이 엄격히 설정되어 있지 않아 외부 도메인에서 API 요청이 차단되었습니다.

   악영향: 사용자들은 Trello 보드에서 플러그인을 통해 데이터를 가져오지 못했으며, 플러그인 기능이 제한되어 사용성이 떨어졌습니다. 이는 Trello의 외부 연동성과 기능 확장성에 큰 영향을 미쳤습니다.

   해결: Trello는 이후 CORS 정책을 보다 세밀하게 관리하고, Access-Control-Allow-Origin 헤더를 업데이트하여 플러그인들이 외부 API에 접근할 수 있도록 허용했습니다.

4. Airbnb의 CORS 문제
   사례: Airbnb에서는 일부 예약 API를 호출할 때 CORS 문제가 발생했습니다. 외부 서비스가 Airbnb API에 접근하려 할 때, CORS 설정이 적절히 되어 있지 않아 요청이 차단되었습니다.

   악영향: Airbnb API에 접근하려는 외부 애플리케이션이나 서비스가 정상적으로 동작하지 않으면서, 여러 파트너 서비스들이 API를 사용할 수 없게 되었습니다. 이로 인해 예약 시스템의 연동이 깨졌습니다.

   해결: Airbnb는 CORS 정책을 개선하고, 특정 파트너 서비스만 API에 접근할 수 있도록 하여 문제를 해결했습니다.

5. Twitter API CORS 문제
   사례: Twitter는 웹 애플리케이션에서 외부 도메인으로 API 호출을 처리할 때 CORS 오류가 발생하는 문제가 있었습니다. 특히 JavaScript를 통해 Twitter API를 직접 호출하는 경우, CORS 허용 헤더가 제대로 설정되지 않아 브라우저에서 요청을 차단하였습니다.

   악영향: Twitter에서 외부 애플리케이션이 자신의 API를 호출할 수 없었으며, 특히 트윗을 외부 사이트에 임베드하거나 실시간 트위터 데이터를 불러오는 기능이 작동하지 않았습니다. 이로 인해 외부 애플리케이션에서 Twitter
   API를 연동하려는 시도가 실패하게 되었습니다.

   해결: Twitter는 API에 대한 CORS 설정을 개선하고, 외부 웹 애플리케이션들이 필요한 데이터를 정상적으로 호출할 수 있도록 도와주는 정책을 세웠습니다.

6. Spotify의 CORS 문제
   사례: Spotify의 웹 플레이어와 앱 통합 서비스에서는 특정 API 호출에서 CORS 정책에 의해 차단된 요청이 있었습니다. Spotify는 CORS가 설정되지 않은 서버에서 음악 데이터를 받아오는 API 요청이 실패한 경우가 있었습니다.

   악영향: 이로 인해 사용자가 Spotify 웹 플레이어에서 외부 서비스를 통한 음악 검색이나 재생이 불가능해졌고, 서비스의 기능적 제약이 발생했습니다.

   해결: Spotify는 외부 애플리케이션들이 데이터에 접근할 수 있도록 CORS 정책을 조정하고, API 호출에 대한 적절한 CORS 헤더를 추가하여 외부 서비스에서 Spotify 데이터를 사용할 수 있도록 하였습니다.

   결론
   위 사례들처럼, CORS 설정 오류나 CORS 정책 미적용으로 인해 데이터 유출, 보안 취약점, 서비스 기능 장애, 사용자 경험 저하 등의 악영향이 발생할 수 있습니다. 따라서 CORS는 매우 중요한 보안 설정으로, 개발 중에는 물론 배포 후에도 적절히 설정을 관리해야 하며, 정상적인 도메인에 대해서만 API 접근을 허용하도록 해야 합니다.
